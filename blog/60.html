<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <script src="/assets/js/close_copy.js"></script>
  

  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  

  <title>JVM应用诊断调优再记</title>

  <link rel="shortcut icon" type="image/x-icon" href="/assets/private/icons/huangdayu.png" />
  <link rel="stylesheet" href="/assets/css/main.css" />
</head><body a="light">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/">博客首页</a><article>
  
  <h1 class="post-header">JVM应用诊断调优再记</h1>

  <p class="post-meta">
    <time datetime="2022-09-04 00:00:00 +0800">2022-09-04</time>
  </p>
  
  <h2 id="前言">前言</h2>

<p>  入职新公司以来，从对业务进行深入了解，到旧项目的重构，及新架构的设计，再新框架的应用，后对新项目的调优，历经了重重困难，对此深有感悟，也算作一次项目重构和调优经验。</p>

<p>  忽然才明白，对于应用层的软件来说，目的是高效利用计算机资源对业务需求提供服务，那么诊断和调优的目的也就是优化对资源的使用，使其更高效，更低消耗，更安全，更稳定。多快好省就对了！</p>

<h2 id="资源利用">资源利用</h2>

<p>  所谓资源，是指CPU，GPU，磁盘，内存，带宽等资源，而在应用的分类上，一般有计算密集型和IO密集型，对于计算密集型，关注的重点则是CPU，GPU资源的使用效率，对于IO密集型，则区分网络IO还是磁盘IO。</p>

<p>  假如业务要求应用必须支持高并发，那么我们第一步想到的肯定是多线程，如果业务允许，甚至异步处理，总之一句话，榨干计算机资源。线程池、连接池、对象池、队列容量、内存大小、任务分割、多线程、多进程、多连接不设上限，不留余地。</p>

<p>  然而，你错了！并发是上来了，却随之出现线程阻塞，线程死锁，内存溢出，队列爆满，任务超时，连接不可用，甚至应用宕机等异常情况。</p>

<h2 id="资源瓶颈">资源瓶颈</h2>

<p>  所以，我们首先要确定我们的业务属于什么样的计算类型，是计算密集型还是IO密集型，那我们应用高并发场景下性能瓶颈在什么地方？即针对性的进行优化，对于网络IO密集型的业务应用来说，如果瓶颈不在网络IO，那么就加大线程池线程大小，使其到达资源瓶颈，如果CPU资源不是瓶颈，那么需要优化业务逻辑，拆分业务处理逻辑，分不同线程处理，分布式处理，甚至分进程处理等方式，加快业务处理逻辑，自然就能支持高并发。</p>

<h2 id="资源控制">资源控制</h2>

<p>  但是，资源有限呢？相对于并发性而言，稳定性对于一个项目来说，似乎更加重要。如果你不能稳定健壮的运行，又谈何高并发的提供服务呢？资源控制是每一个 应用在开发过程中都必须要时时在意的东西。就拿一个视频流处理程序来所，每一帧图片都是1M的内存控制，如果你的队列不限制大小，你的线程池策略不合理，那么内存溢出的风险永远存在。如果做到有效的资源控制，这考验程序员对业务的了解程度。</p>

<p>  线程池线程数要设置多少合理，如何动态设置线程池的核心线程大小，有界队列的大小设置多少合适，磁盘读写逻辑应该如何设计，网络交互是否不设上限，它们之间如何取得资源平衡，从生产，到消费，再到回收，如何进行高效利用，如何防止资源溢出，如何控制资源调度，又如何防止资源过剩，这是非常大的难题，不同的业务自然是不同的策略，不同的解决方案。</p>

<h2 id="资源调度">资源调度<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></h2>

<p>  有时，业务需求使用资源会有多种情况，有用完即释放回收的网络型，有长时间占用大量资源的计算密集型，有大量业务访问的IO密集型，这样便一定会遇到资源在某种特性情况下达到瓶颈。所以，资源调度成为不可或缺的高效利用资源的手段，资源洪峰时，降低非即时性业务的资源使用，资源低谷时，调高非即时性业务的资源使用，所谓削峰填谷，这也是一种丢车保帅的随机应变策略。 在微服务体系中的高可用流控防护组件便是此作用，所谓流量治理组件，包括流量控制，流量路由，熔断降级，系统自适应保护等。K8S生态便是为实现机器资源高效利用而生。</p>

<p>  记住，无论是依托自动算法还是手动改变策略进行资源调度，其目的都是高效利用资源，以达到最小资源实现业务最大化，需更具业务情况的不同也采用符合满足需求的策略。</p>

<h2 id="资源释放">资源释放</h2>

<p>  不过，有一点非常重要的是，资源的释放一定要及时，合理且高效。业务中用完的资源要置空，促进GC的回收，容易造成阻塞的，有内存空间消耗的任务一定要在finally中进行释放，耗时较长的任务要限定超时时间，创建的子进程执行完任务之后一定要释放，其中，最重要的是要在try之后finally中进行资源的释放，这是一种好的编程习惯。</p>

<h2 id="资源升级">资源升级</h2>

<p>  当然，如果你觉得上述的几点你都做的足够优秀，已经没有优化空间，条件允许的情况下，升级资源也不失为一个选项。</p>

<h2 id="小结">小结</h2>

<p>  这是关于JVM应用诊断调优的第3篇水文，从新时空的停车系统参与性能调优以来，到现在的边缘服务的高并发高可用调优，也幸庆积累了一点点对Java应用的调优经验，也算不枉我的视力下降如楼塌吧！</p>

<p><strong>解决问题要从问题本质着手。</strong></p>

<p align="right">开元4720年捌月初九 广州</p>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">
      <p>2022-11-12 新增资源调度 <a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>
<br/>
<a style="display: block;text-align:right;" href="/">博客首页</a>
<br/>
<p style="display: block;text-align:center;">©2012-2022 huangdayu.cn(大鱼叔叔的博客) 版权所有，未经授权，不得转载。</p>
<br/></article>


      </div>
    </main>
  </body>
</html>